# 온체인 프로그램과 가상 머신
블록체인은 프로토콜의 특성에 따라 분산 서버에 특정 연산을 수행하는 프로그램을 저장할 수 있다. 예를 들어 비트코인은 토큰 전송과 HD 지갑 생성과 같은 프로그램을 처리할 수 있고 이더리움은 자체적인 가상 머신(Ethereum Virtual Machine, 혹은 EVM)을 활용하여 토큰 발매, 환전과 같은 복잡한 프로그램 연산이 가능하다. 

## 온체인 프로그램과 가상 머신의 정의
온체인 프로그램이란 블록체인에 저장된 코드에 따라 실행되는 프로그램을 의미한다. 온체인 프로그램은 블록체인의 특성에 의거하여 구동하기 때문에 배포자라고 해도 실행된 프로그램을 임의로 변경하기 어렵다. 프로그램의 실행이 모두 트랜잭션으로 남기 때문이다. 온체인은 프로그램은 스마트 컨트랙트라는 이름으로도 널리 알려져 있다. 계약서를 작성하듯 코드를 통해 상호 규약을 설정하고 자동으로 실행되는 환경을 구축하기 때문이다.

복잡한 연산 수행이 가능한 프로그램을 작성하기 위해서 각 체인은 자체적인 가상 머신을 구동한다. 예를 들어 이더리움과 유사 체인들은 EVM을 코스모스, 솔라나와 같은 체인은 WASM에 기반한 자체 VM을 수이, 앱토스와 같은 체인은 무브(Move) 언어에 기반한 가상 머신을 구현한다. 이러한 가상 머신에 따라 컨트랙트 작성 언어와 연산 방식 등이 달라질 수 있다. 

## 온체인 프로그램의 구동 원리
온체인 프로그램의 실행은 다음과 같은 절차를 거친다.
1. 프로그램 작성: 프로그래머가 온체인 프로그램 코드를 작성한다. 배포하고자 하는 네트워크(ex. 이더리움, 솔라나)에서 통용되는 프로그래밍 언어 선택(ex. 솔리디티, 러스트, 무브)이 필요하다
2. 컴파일링 및 배포: 작성된 프로그램을 블록체인 네트워크에 배포하기 위한 작업이다. 프로그램을 컴파일링하면 블록체인에서 처리 가능한 형태의 바이트코드로 변환한다. 이를 네트워크에 배포하여 트랜잭션 처리를 요청한다
3. 블록 반영: 요청한 트랜잭션이 처리되는 과정이다. 자세한 내용은 [트랜잭션과 블록](./2-1-3.%20%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EA%B3%BC%20%EB%B8%94%EB%A1%9D.md)을 참고한다
4. 온체인 프로그램 확인: 블록에 반영된 프로그램을 확인한다. 기본적으로 트랜잭션 확인 과정과 동일하다

## 온체인 프로그램과 디앱
개발자는 온체인 프로그램을 활용하여 사용자가 상호 작용이 가능한 환경을 제공할 수 있다. 컴퓨터, 핸드폰과 같은 기기를 통해 웹/모바일 어플리케이션에 접속하듯 온체인 프로그램의 기능을 활용한 어플리케이션 제작이 가능한 것이다. 온체인 프로그램의 기능으 활용하여 사용자가 접속 가능한 어플리케이션을 디앱이라고 한다. 웹3는 다양한 기능을 가진 디앱들을 통해 사용 환경이 발전하고 있다 
